<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Lik App</title>

<link rel="stylesheet" href="css/style.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>

<body>

<header class="topo">
<h2>Lik App</h2>
<button onclick="logout()">Sair</button>
</header>

<div class="tabs">
<button id="tabTreino" class="active" onclick="mostrarTreino()">Treino</button>
<button id="tabAgua" onclick="mostrarAgua()">√Ågua</button>
</div>

<!-- TREINO -->
<section id="secTreino">

<h3 id="tituloTreino">Treino</h3>
<div id="listaTreino"></div>

</section>

<!-- AGUA -->
<section id="secAgua" style="display:none">

<h3>Hidrata√ß√£o</h3>

<input id="aguaInput" type="number" placeholder="ml">
<button onclick="addAgua(200)">+200</button>
<button onclick="addAgua(500)">+500</button>
<button onclick="salvarAgua()">Salvar</button>

<p id="statusAgua">0 ml</p>

</section>

<script src="js/firebase.js"></script>

<script>

// PROTEGER
auth.onAuthStateChanged(user=>{
  if(!user){
    window.location="login.html";
  }
});

// LOGOUT
function logout(){
  auth.signOut();
}

// ABAS
function mostrarTreino(){
  secTreino.style.display="block";
  secAgua.style.display="none";
}

function mostrarAgua(){
  secTreino.style.display="none";
  secAgua.style.display="block";
}

// ================== TREINO ==================

async function carregarTreino(){

  const user = auth.currentUser;
  if(!user) return;

  const doc = await db
    .collection("treinos_usuarios")
    .doc(user.uid)
    .get();

  if(!doc.exists){
    listaTreino.innerHTML="<p>Nenhum treino atribu√≠do</p>";
    return;
  }

  const treino = doc.data();

  tituloTreino.innerText = treino.nome;
  listaTreino.innerHTML="";

  treino.exercicios.forEach(ex=>{

    const div=document.createElement("div");
    div.className="exercise";

    div.innerHTML=`
      <input type="checkbox" onchange="verificarConclusao()">
      <span>${ex.nome} (${ex.series})</span>
      <input type="number" value="${ex.carga}">
    `;

    listaTreino.appendChild(div);
  });

}

carregarTreino();

// AUTO SALVAR
async function verificarConclusao(){

  const checks=document.querySelectorAll("#listaTreino input[type=checkbox]");
  const todos=[...checks].every(c=>c.checked);

  if(!todos) return;

  const user=auth.currentUser;

  const historico=[];

  document.querySelectorAll("#listaTreino .exercise")
    .forEach(d=>{
      historico.push({
        nome:d.querySelector("span").innerText,
        carga:d.querySelector("input[type=number]").value
      });
    });

  await db
    .collection("historico")
    .doc(user.uid)
    .collection("dias")
    .doc(new Date().toISOString().split("T")[0])
    .set({
      treino: tituloTreino.innerText,
      exercicios: historico,
      data:new Date()
    });

  alert("Treino conclu√≠do e salvo üí™üî•");
}

// ================== AGUA ==================

let aguaHoje=0;

function addAgua(v){
  aguaHoje+=v;
  atualizarAgua();
}

function salvarAgua(){
  aguaHoje+=Number(aguaInput.value||0);
  aguaInput.value="";
  atualizarAgua();
}

function atualizarAgua(){
  statusAgua.innerText=aguaHoje+" ml";
}

</script>

</body>
</html>
